<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="//cdn.webix.com/edge/webix.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="//cdn.webix.com/materialdesignicons/5.8.95/css/materialdesignicons.min.css"
      type="text/css"
      charset="utf-8"
    />
    <link rel="stylesheet" href="./style.css" />
    <script src="//cdn.webix.com/edge/webix.js" type="text/javascript"></script>
  </head>
  <body>
    <script type="text/javascript" src="./testdata.js"></script>
    <script type="text/javascript" charset="utf-8">
      webix.ready(function () {
        //create consts for object IDs
        const movieListID = "movieList";
        const formID = "movieForm";
        const currYear = new Date().getFullYear();
        // create form input fields
        const formLabels = [
          {name: "Title", invMes: "Can't be empty"}, 
          {name: "Year", invMes: `Enter a year between 1970 and ${currYear}`},
          {name: "Rating", invMes:"Should be more than 0"}, 
          {name: "Votes", invMes:"Can't be more than 100000"}, 
          {name: "Category"}];
        const formElements = formLabels.map((el) => {
          if (el.name === "Year") {
            return {
              view: "datepicker",
              label: el.name,
              type: "year",
              format: "%Y",
              name: el.name.toLowerCase(),
              value: "",
              invalidMessage: el.invMes
            };
          } else
            return {
              view: "text",
              label: el.name,
              value: "",
              name: el.name.toLowerCase(),
              invalidMessage: el.invMes
            };
        });
        
        // first row of the layout
        const header = {
          view: "toolbar",
          type: "clean",
          css: "heading",
          elements: [
            {
              view: "template",
              type: "header",
              template: "My App!",
              css: "heading",
              borderless: true,
            },
            {},
            {
              padding: 5,
              view: "button",
              type: "icon",
              icon: "mdi mdi-account",
              label: "Profile",
              autowidth: true,
              css: "btn",
              popup: "poppy"
              
            },
          ],
        };

        // first column of the 2nd row (list)
        const side = {
          type: "clean",
          css: "side",
          rows: [
            {
              view: "list",
              width: 150,
              scroll: false,
              data: ["Dashboard", "Users", "Products", "Locations"],
              gravity: 10,
              css: "webix_list_item",
            },
            {
              template: "&#10004; Connected",
              height: 30,
              css: "bottom_side",
            },
          ],
        };
        // second column of the 2nd row (datatable with films list)
        const movieList = {
          view: "datatable",
          autoConfig: true,
          data: small_film_set,
          gravity: 2.5,
          scrollX: false,
          select: true,
          id: movieListID,
        };
        // third column of the 2nd row(form)
        const form = {
          type: "clean",
          rows: [
            {
              view: "form",
              id: formID,
              elements: [
                { type: "section", template: "edit films" },
                ...formElements,
                {
                  margin: 5,
                  cols: [
                    {
                      view: "button",
                      value: "Add new",
                      css: "add_btn",
                      click: addItem,
                    },
                    {
                      view: "button",
                      value: "Clear",
                      click: function () {
                        $$(formID).clear();
                        $$(formID).clearValidation();

                      },
                    },
                  ],
                },
              ],
              // rules for input validation
              rules: {
                rating: function(value){
                  return webix.rules.isNotEmpty(value) && webix.rules.isNumber(value) && parseFloat(value)!==0 },
                votes: function(value){
                  return webix.rules.isNumber(value) && value < 100000},
                title: webix.rules.isNotEmpty,
                year: function(value){
                  return webix.rules.isNotEmpty(value) && value.getFullYear()>=1970 && value.getFullYear()<= currYear;
                }
                },
            },
            {},
          ],
        };
        // second row of the layout
        const main = {
          cols: [side, { view: "resizer" }, movieList, form],
          gravity: 10,
        };
        // third row
        const footer = {
          view: "template",
          template:
            "The software is provided by <a href='https://webix.com'  target='_blank'>https://webix.com.</a> All rights reserved &copy",
          css: "footer",
          autoheight: true,
        };
        // executed when "Add new" button is clicked: add new film to the film list
        function addItem() {
          if ($$(formID).validate()) {
            const newData = $$(formID).getValues();
            newData.year = newData.year.getFullYear();
            newData.rank = "#";
            $$(movieListID).add(newData);
            webix.message("All is correct")
            $$(formID).clear();
          }
        }
        webix.ui({
          rows: [header, main, footer],
        });
        //create popup
        webix.ui({
          view: "popup",
          id: "poppy",
          width: 200,
          body:{
            view: "list",
            data:[
              "Settings", "Log Out"],
            autoheight: true,
            select:true,
          }
        })
      });
    </script>
  </body>
</html>
